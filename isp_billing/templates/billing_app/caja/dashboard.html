{% extends 'base.html' %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <div class="card border-0 shadow-sm" style="background: linear-gradient(120deg, rgba(46,204,113,0.12), rgba(52,152,219,0.08));">
            <div class="card-body d-flex flex-wrap justify-content-between align-items-center">
                <div>
                    <h2 class="fw-bold mb-1"><i class="fas fa-wallet me-2 text-success"></i>Caja</h2>
                    <p class="text-muted mb-0">Controla ingresos y egresos por periodo.</p>
                </div>
                <div class="d-flex gap-2 mt-3 mt-md-0">
                    <span class="badge bg-success bg-opacity-10 text-success">
                        {{ start_date|date:"d/m/Y" }} - {{ end_date|date:"d/m/Y" }}
                    </span>
                    <span class="badge bg-primary bg-opacity-10 text-primary">Balance</span>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mb-3">
    <div class="col-12">
        <div class="card border-0 shadow-sm">
            <div class="card-body">
                <form method="get" class="row g-2 align-items-end">
                    <div class="col-md-4">
                        <label class="form-label small fw-bold text-muted">Periodo</label>
                        <select class="form-select" name="periodo">
                            <option value="dia" {% if periodo == 'dia' %}selected{% endif %}>Día</option>
                            <option value="semanal" {% if periodo == 'semanal' %}selected{% endif %}>Semanal</option>
                            <option value="quincenal" {% if periodo == 'quincenal' %}selected{% endif %}>Quincenal</option>
                            <option value="mensual" {% if periodo == 'mensual' %}selected{% endif %}>Mensual</option>
                            <option value="trimestral" {% if periodo == 'trimestral' %}selected{% endif %}>Trimestral</option>
                            <option value="anual" {% if periodo == 'anual' %}selected{% endif %}>Anual</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label small fw-bold text-muted">Desde</label>
                        <input type="date" class="form-control" name="fecha_inicio" value="{{ fecha_inicio|default:'' }}">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label small fw-bold text-muted">Hasta</label>
                        <input type="date" class="form-control" name="fecha_fin" value="{{ fecha_fin|default:'' }}">
                    </div>
                    <div class="col-md-2">
                        <button class="btn btn-primary">
                            <i class="fas fa-filter me-2"></i>Filtrar
                        </button>
                        <a class="btn btn-outline-secondary ms-2" href="{% url 'caja-dashboard' %}">
                            Quitar filtro
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="row g-4">
    <div class="col-md-4">
        <div class="card glass border-0">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <p class="text-muted small fw-bold mb-1">Ingresos del periodo</p>
                        <h3 class="mb-0 text-success">S/ {{ ingresos_total|floatformat:2 }}</h3>
                    </div>
                    <div class="bg-success bg-opacity-10 p-3 rounded-circle">
                        <i class="fas fa-arrow-up-right-dots text-success"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card glass border-0">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <p class="text-muted small fw-bold mb-1">Egresos de hoy</p>
                        <h3 class="mb-0 text-danger">S/ {{ total_egresos|floatformat:2 }}</h3>
                    </div>
                    <div class="bg-danger bg-opacity-10 p-3 rounded-circle">
                        <i class="fas fa-arrow-down-left-dots text-danger"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card glass border-0">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <p class="text-muted small fw-bold mb-1">Balance</p>
                        <h3 class="mb-0">S/ {{ balance_hoy|floatformat:2 }}</h3>
                    </div>
                    <div class="bg-primary bg-opacity-10 p-3 rounded-circle">
                        <i class="fas fa-scale-balanced text-primary"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row g-4 mt-1">
    <div class="col-lg-6">
        <div class="card border-0">
            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                <h6 class="mb-0 fw-bold"><i class="fas fa-file-invoice me-2 text-success"></i>Ingresos del periodo</h6>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="bg-light small">
                            <tr>
                                <th class="ps-4">Fecha</th>
                                <th>Cliente</th>
                                <th>Concepto</th>
                                <th class="text-end">Monto</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for ingreso in ingresos_list %}
                            <tr>
                                <td class="ps-4">{{ ingreso.fecha|date:"d/m/Y H:i" }}</td>
                                <td>{{ ingreso.cliente.apellidos }}, {{ ingreso.cliente.nombres }}</td>
                                <td>{{ ingreso.detalles|default:ingreso.tipo_comprobante }}</td>
                                <td class="text-end fw-bold text-success">S/ {{ ingreso.monto|floatformat:2 }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4" class="text-center py-4 text-muted">No hay ingresos en este periodo.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-6">
        <div class="card border-0">
            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                <h6 class="mb-0 fw-bold"><i class="fas fa-file-invoice-dollar me-2 text-danger"></i>Egresos del periodo</h6>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="bg-light small">
                            <tr>
                                <th class="ps-4">Fecha</th>
                                <th>Concepto</th>
                                <th>Comprobante</th>
                                <th>Responsable</th>
                                <th class="text-end">Monto</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for egreso in egresos_hoy %}
                            <tr>
                                <td class="ps-4">{{ egreso.fecha|date:"d/m/Y" }}</td>
                                <td>{{ egreso.concepto.nombre }}</td>
                                <td>{{ egreso.tipo_comprobante }} {{ egreso.numero_comprobante }}</td>
                                <td>{{ egreso.responsable }}</td>
                                <td class="text-end fw-bold text-danger">S/ {{ egreso.monto|floatformat:2 }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5" class="text-center py-4 text-muted">No hay egresos en este periodo.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-5">
        <div class="card border-0">
            <div class="card-header bg-white">
                <h6 class="mb-0 fw-bold"><i class="fas fa-pen-to-square me-2 text-primary"></i>Registrar egreso</h6>
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label class="form-label small fw-bold text-muted">Fecha</label>
                        {{ form_egreso.fecha }}
                    </div>
                    <div class="mb-3">
                        <label class="form-label small fw-bold text-muted">Tipo de comprobante</label>
                        {{ form_egreso.tipo_comprobante }}
                    </div>
                    <div class="mb-3">
                        <label class="form-label small fw-bold text-muted">Número de comprobante</label>
                        {{ form_egreso.numero_comprobante }}
                    </div>
                    <div class="mb-3">
                        <label class="form-label small fw-bold text-muted">Monto</label>
                        {{ form_egreso.monto }}
                    </div>
                    <div class="mb-3">
                        <label class="form-label small fw-bold text-muted">Concepto</label>
                        {{ form_egreso.concepto }}
                    </div>
                    <div class="mb-3">
                        <label class="form-label small fw-bold text-muted">Responsable</label>
                        {{ form_egreso.responsable }}
                    </div>
                    <div class="mb-3">
                        <label class="form-label small fw-bold text-muted">Observaciones</label>
                        {{ form_egreso.observaciones }}
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-save me-2"></i>Guardar egreso
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
